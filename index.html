<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè¶ GoKens Bank AI - BCC Hackathon 2025</title>
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            padding: 40px 0;
            animation: fadeIn 1s;
        }
        
        .header h1 {
            font-size: 48px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            animation: slideIn 0.5s;
        }
        
        .section-title {
            font-size: 24px;
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .file-upload-area:hover {
            background: #f8f9ff;
            border-color: #764ba2;
        }
        
        .file-upload-area.active {
            background: #f0f4ff;
            border-color: #10b981;
        }
        
        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin: 20px 0;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f5f7ff 0%, #e8ecff 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 14px;
            color: #6b7280;
            margin-top: 5px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            font-size: 16px;
            position: relative;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .client-card {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            animation: slideIn 0.3s;
        }
        
        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .product-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
            margin: 10px 0;
        }
        
        .notification-box {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #f3f4f6;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
        }
        
        .phone-mockup {
            background: #1f2937;
            border-radius: 30px;
            padding: 20px;
            max-width: 350px;
            margin: 20px auto;
        }
        
        .phone-screen {
            background: white;
            border-radius: 20px;
            padding: 10px;
            margin-top: 40px;
        }
        
        .notification-preview {
            display: flex;
            align-items: flex-start;
            padding: 10px;
        }
        
        .app-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            margin-right: 10px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .hidden {
            display: none;
        }
        
        #chartContainer {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¶ GoKens Bank AI</h1>
            <p style="font-size: 20px; opacity: 0.9;">–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π</p>
            <p style="opacity: 0.8;">–•–∞–∫–∞—Ç–æ–Ω AI BCC 2025</p>
        </div>
        
        <div class="main-grid">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="panel">
                <h2 class="section-title">
                    <span>üìÅ</span> –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                </h2>
                
                <div class="file-upload-area" id="uploadArea">
                    <input type="file" class="file-input" id="fileInput" multiple accept=".csv">
                    <div class="upload-icon">üì§</div>
                    <p style="font-weight: 600; margin: 10px 0;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —Ñ–∞–π–ª—ã</p>
                    <p style="font-size: 14px; color: #6b7280;">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ 121 —Ñ–∞–π–ª</p>
                </div>
                
                <div id="filesList" class="hidden" style="max-height: 200px; overflow-y: auto; margin: 20px 0;"></div>
                
                <button class="btn" id="processBtn" onclick="processData()" disabled>
                    üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑
                </button>
                
                <div class="progress-bar hidden" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                
                <div class="stats-grid hidden" id="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="clientCount">0</div>
                        <div class="stat-label">–ö–ª–∏–µ–Ω—Ç–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="productCount">0</div>
                        <div class="stat-label">–ü—Ä–æ–¥—É–∫—Ç–æ–≤</div>
                    </div>
                </div>
                
                <button class="btn btn-success hidden" id="downloadBtn" onclick="downloadCSV()">
                    üíæ –°–∫–∞—á–∞—Ç—å CSV
                </button>
            </div>
            
            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ -->
            <div class="panel">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('results')">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
                    <button class="tab" onclick="switchTab('analytics')">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
                    <button class="tab" onclick="switchTab('examples')">üì± –ü—Ä–∏–º–µ—Ä—ã</button>
                </div>
                
                <div class="tab-content active" id="resultsTab">
                    <h2 class="section-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h2>
                    <div id="resultsContainer">
                        <p style="color: #6b7280; text-align: center; padding: 40px;">
                            –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–Ω–∞–ª–∏–∑
                        </p>
                    </div>
                </div>
                
                <div class="tab-content" id="analyticsTab">
                    <h2 class="section-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                    <div id="chartContainer"></div>
                </div>
                
                <div class="tab-content" id="examplesTab">
                    <h2 class="section-title">–ü—Ä–∏–º–µ—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h2>
                    <div id="examplesContainer"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let clientsData = null;
        let transactionsData = {};
        let transfersData = {};
        let results = [];
        
        // –ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        const PRODUCTS = {
            '–ö–∞—Ä—Ç–∞ –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π': { cashback: 0.04, categories: ['–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è', '–¢–∞–∫—Å–∏', '–û—Ç–µ–ª–∏'] },
            '–ü—Ä–µ–º–∏–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞': { minBalance: 1000000, cashback: 0.03 },
            '–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞': { cashback: 0.10, categories: ['–ï–¥–∏–º –¥–æ–º–∞', '–°–º–æ—Ç—Ä–∏–º –¥–æ–º–∞', '–ò–≥—Ä–∞–µ–º –¥–æ–º–∞'] },
            '–î–µ–ø–æ–∑–∏—Ç –°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω—ã–π': { rate: 0.165, minBalance: 100000 },
            '–î–µ–ø–æ–∑–∏—Ç –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π': { rate: 0.155, minBalance: 100000 },
            '–î–µ–ø–æ–∑–∏—Ç –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω—ã–π': { rate: 0.145, minBalance: 100000 },
            '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏': { potentialReturn: 0.20, minBalance: 500000 },
            '–û–±–º–µ–Ω –≤–∞–ª—é—Ç': { savings: 0.01 },
            '–ö—Ä–µ–¥–∏—Ç –Ω–∞–ª–∏—á–Ω—ã–º–∏': { rate: 0.12 },
            '–ó–æ–ª–æ—Ç—ã–µ —Å–ª–∏—Ç–∫–∏': { minBalance: 500000 }
        };
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                handleFiles(files);
            }
        });
        
        async function handleFiles(files) {
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.classList.add('active');
            
            const filesList = document.getElementById('filesList');
            filesList.innerHTML = '<p style="font-weight: 600; margin-bottom: 10px;">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</p>';
            filesList.classList.remove('hidden');
            
            for (const file of files) {
                const fileName = file.name;
                filesList.innerHTML += `<div style="padding: 5px; background: #f3f4f6; margin: 2px 0; border-radius: 5px;">üìÑ ${fileName}</div>`;
                
                // –ß—Ç–µ–Ω–∏–µ –∏ –ø–∞—Ä—Å–∏–Ω–≥ CSV
                const text = await file.text();
                const parsed = Papa.parse(text, { header: true, dynamicTyping: true });
                
                if (fileName === 'clients.csv') {
                    clientsData = parsed.data;
                } else if (fileName.includes('transactions')) {
                    const clientId = parseInt(fileName.match(/client_(\d+)/)[1]);
                    transactionsData[clientId] = parsed.data;
                } else if (fileName.includes('transfers')) {
                    const clientId = parseInt(fileName.match(/client_(\d+)/)[1]);
                    transfersData[clientId] = parsed.data;
                }
            }
            
            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
            if (clientsData) {
                document.getElementById('processBtn').disabled = false;
                document.getElementById('uploadArea').innerHTML = `
                    <div class="upload-icon">‚úÖ</div>
                    <p style="font-weight: 600; color: #10b981;">–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${files.length} —Ñ–∞–π–ª–æ–≤</p>
                `;
            }
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
        async function processData() {
            if (!clientsData) return;
            
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            progressBar.classList.remove('hidden');
            
            results = [];
            
            for (let i = 0; i < clientsData.length; i++) {
                const client = clientsData[i];
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                progressFill.style.width = `${((i + 1) / clientsData.length) * 100}%`;
                
                // –ê–Ω–∞–ª–∏–∑ –∫–ª–∏–µ–Ω—Ç–∞
                const features = extractFeatures(client, 
                    transactionsData[client.client_code] || [], 
                    transfersData[client.client_code] || []);
                
                // –í—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞
                const bestProduct = selectBestProduct(features);
                
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                const notification = generateNotification(client, bestProduct, features);
                
                results.push({
                    client_code: client.client_code,
                    product: bestProduct.name,
                    push_notification: notification
                });
                
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            displayResults();
            displayAnalytics();
            displayExamples();
            
            // –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            document.getElementById('stats').classList.remove('hidden');
            document.getElementById('clientCount').textContent = results.length;
            document.getElementById('productCount').textContent = new Set(results.map(r => r.product)).size;
            
            // –ü–æ–∫–∞–∑ –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            document.getElementById('downloadBtn').classList.remove('hidden');
        }
        
        // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
        function extractFeatures(client, transactions, transfers) {
            const features = {
                name: client.name,
                age: client.age,
                status: client.status,
                balance: client.avg_monthly_balance_KZT,
                city: client.city
            };
            
            // –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            if (transactions.length > 0) {
                features.totalSpending = transactions.reduce((sum, t) => sum + (t.amount || 0), 0);
                
                const categorySpending = {};
                transactions.forEach(t => {
                    if (t.category) {
                        categorySpending[t.category] = (categorySpending[t.category] || 0) + t.amount;
                    }
                });
                
                features.travelSpending = (categorySpending['–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è'] || 0) + 
                                         (categorySpending['–¢–∞–∫—Å–∏'] || 0) + 
                                         (categorySpending['–û—Ç–µ–ª–∏'] || 0);
                
                features.premiumSpending = (categorySpending['–Æ–≤–µ–ª–∏—Ä–Ω—ã–µ —É–∫—Ä–∞—à–µ–Ω–∏—è'] || 0) + 
                                          (categorySpending['–ö–æ—Å–º–µ—Ç–∏–∫–∞ –∏ –ü–∞—Ä—Ñ—é–º–µ—Ä–∏—è'] || 0) + 
                                          (categorySpending['–ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã'] || 0);
                
                features.onlineSpending = (categorySpending['–ï–¥–∏–º –¥–æ–º–∞'] || 0) + 
                                         (categorySpending['–°–º–æ—Ç—Ä–∏–º –¥–æ–º–∞'] || 0) + 
                                         (categorySpending['–ò–≥—Ä–∞–µ–º –¥–æ–º–∞'] || 0);
                
                const sortedCategories = Object.entries(categorySpending)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3);
                features.topCategories = sortedCategories.map(c => c[0]);
            } else {
                // –≠–≤—Ä–∏—Å—Ç–∏–∫–∞ –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                features.totalSpending = features.balance * 0.9;
                features.travelSpending = features.totalSpending * 0.1;
                features.premiumSpending = features.totalSpending * 0.05;
                features.onlineSpending = features.totalSpending * 0.15;
                features.topCategories = ['–ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è', '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è'];
            }
            
            // –ê–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
            if (transfers.length > 0) {
                const income = transfers.filter(t => t.direction === 'in')
                    .reduce((sum, t) => sum + (t.amount || 0), 0);
                const expense = transfers.filter(t => t.direction === 'out')
                    .reduce((sum, t) => sum + (t.amount || 0), 0);
                
                features.fxActive = transfers.some(t => t.type === 'fx_buy' || t.type === 'fx_sell');
                features.hasLoans = transfers.some(t => t.type === 'loan_payment_out');
            } else {
                features.fxActive = features.city === '–ê–ª–º–∞—Ç—ã' || features.city === '–ê—Å—Ç–∞–Ω–∞';
                features.hasLoans = false;
            }
            
            return features;
        }
        
        // –í—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
        function selectBestProduct(features) {
            const scores = [];
            
            // –ö–∞—Ä—Ç–∞ –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π
            if (features.travelSpending > 0) {
                const benefit = features.travelSpending * 0.04;
                scores.push({
                    name: '–ö–∞—Ä—Ç–∞ –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π',
                    score: Math.min(1, features.travelSpending / features.totalSpending * 3),
                    benefit: benefit
                });
            }
            
            // –ü—Ä–µ–º–∏–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞
            if (features.balance >= 1000000) {
                const cashbackRate = features.balance >= 6000000 ? 0.04 : 0.03;
                const benefit = Math.min(features.totalSpending * cashbackRate, 300000);
                scores.push({
                    name: '–ü—Ä–µ–º–∏–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞',
                    score: features.balance / 3000000,
                    benefit: benefit
                });
            }
            
            // –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞
            if (features.age >= 21 && features.age <= 50) {
                const benefit = features.onlineSpending * 0.10;
                scores.push({
                    name: '–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞',
                    score: features.onlineSpending / features.totalSpending,
                    benefit: benefit
                });
            }
            
            // –î–µ–ø–æ–∑–∏—Ç –°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω—ã–π
            if (features.balance >= 100000) {
                const benefit = features.balance * 0.165 / 4;
                scores.push({
                    name: '–î–µ–ø–æ–∑–∏—Ç –°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω—ã–π',
                    score: features.balance / 2000000 * 0.9,
                    benefit: benefit
                });
            }
            
            // –î–µ–ø–æ–∑–∏—Ç –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π
            if (features.balance >= 100000 && features.status === '–ó–∞—Ä–ø–ª–∞—Ç–Ω—ã–π –∫–ª–∏–µ–Ω—Ç') {
                const benefit = features.balance * 0.155 / 4;
                scores.push({
                    name: '–î–µ–ø–æ–∑–∏—Ç –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π',
                    score: features.balance / 2000000 * 0.8,
                    benefit: benefit
                });
            }
            
            // –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
            if (features.balance >= 500000 && !features.hasLoans) {
                const benefit = features.balance * 0.20 / 4;
                scores.push({
                    name: '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏',
                    score: features.balance / 3000000 * 0.6,
                    benefit: benefit
                });
            }
            
            // –û–±–º–µ–Ω –≤–∞–ª—é—Ç
            if (features.fxActive) {
                scores.push({
                    name: '–û–±–º–µ–Ω –≤–∞–ª—é—Ç',
                    score: 0.4,
                    benefit: features.totalSpending * 0.01
                });
            }
            
            // –í—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ
            scores.sort((a, b) => b.score - a.score);
            return scores[0] || { name: '–î–µ–ø–æ–∑–∏—Ç –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π', benefit: features.balance * 0.155 / 4 };
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function generateNotification(client, product, features) {
            const name = client.name;
            const benefit = Math.round(product.benefit).toLocaleString('ru-RU').replace(/,/g, ' ');
            const isYoung = client.age < 30;
            
            const templates = {
                '–ö–∞—Ä—Ç–∞ –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π': [
                    `${name}, –≤ —è–Ω–≤–∞—Ä–µ —É –≤–∞—Å –º–Ω–æ–≥–æ –ø–æ–µ–∑–¥–æ–∫/—Ç–∞–∫—Å–∏. –° —Ç—Ä–µ–≤–µ–ª-–∫–∞—Ä—Ç–æ–π —á–∞—Å—Ç—å —Ä–∞—Å—Ö–æ–¥–æ–≤ –≤–µ—Ä–Ω—É–ª–∞—Å—å –±—ã –∫–µ—à–±—ç–∫–æ–º. –•–æ—Ç–∏—Ç–µ –æ—Ñ–æ—Ä–º–∏—Ç—å?`,
                    `${name}, —Ç—Ä–∞—Ç—ã –Ω–∞ –ø–æ–µ–∑–¥–∫–∏ ${Math.round(features.travelSpending).toLocaleString('ru-RU').replace(/,/g, ' ')} ‚Ç∏. –ö–∞—Ä—Ç–∞ –≤–µ—Ä–Ω—ë—Ç ${benefit} ‚Ç∏. –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É.`
                ],
                '–ü—Ä–µ–º–∏–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞': [
                    `${name}, —É –≤–∞—Å —Å—Ç–∞–±–∏–ª—å–Ω–æ –∫—Ä—É–ø–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –∏ —Ç—Ä–∞—Ç—ã –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö. –ü—Ä–µ–º–∏–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –¥–∞—Å—Ç –ø–æ–≤—ã—à–µ–Ω–Ω—ã–π –∫–µ—à–±—ç–∫ –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Å–Ω—è—Ç–∏—è. –û—Ñ–æ—Ä–º–∏—Ç—å —Å–µ–π—á–∞—Å.`,
                    `${name}, –≤–∞—à —Å—Ç–∞—Ç—É—Å –¥–∞—ë—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞. –î–æ 4% –∫–µ—à–±—ç–∫–∞, –≤—ã–≥–æ–¥–∞ ${benefit} ‚Ç∏/–∫–≤–∞—Ä—Ç–∞–ª. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å.`
                ],
                '–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞': [
                    `${name}, –≤–∞—à–∏ —Ç–æ–ø-–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî ${features.topCategories.slice(0, 2).join(', ')}. –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞ –¥–∞—ë—Ç –¥–æ 10% –≤ –ª—é–±–∏–º—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö. –û—Ñ–æ—Ä–º–∏—Ç—å –∫–∞—Ä—Ç—É.`,
                    `${name}, –∫–µ—à–±—ç–∫ 10% –Ω–∞ –ª—é–±–∏–º—ã–µ –ø–æ–∫—É–ø–∫–∏! –≠–∫–æ–Ω–æ–º–∏—è ${benefit} ‚Ç∏. –ü–æ–¥–∫–ª—é—á–∏—Ç—å.`
                ],
                '–î–µ–ø–æ–∑–∏—Ç –°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω—ã–π': [
                    `${name}, —É –≤–∞—Å –æ—Å—Ç–∞—é—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –∏—Ö –Ω–∞ –≤–∫–ª–∞–¥–µ ‚Äî —É–¥–æ–±–Ω–æ –∫–æ–ø–∏—Ç—å –∏ –ø–æ–ª—É—á–∞—Ç—å –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ. –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥.`,
                    `${name}, –¥–µ–ø–æ–∑–∏—Ç 16,5% –≥–æ–¥–æ–≤—ã—Ö –ø—Ä–∏–Ω–µ—Å—ë—Ç ${benefit} ‚Ç∏ –∑–∞ –∫–≤–∞—Ä—Ç–∞–ª. –ù–∞—á–∞—Ç—å –∫–æ–ø–∏—Ç—å.`
                ],
                '–î–µ–ø–æ–∑–∏—Ç –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π': [
                    `${name}, –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∫–ª–∞–¥ 15,5% —Å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º. –î–æ—Ö–æ–¥ ${benefit} ‚Ç∏ –∑–∞ 3 –º–µ—Å—è—Ü–∞. –û—Ç–∫—Ä—ã—Ç—å.`,
                    `${name}, –æ—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ —Å –≤—ã–≥–æ–¥–æ–π. 15,5% –≥–æ–¥–æ–≤—ã—Ö, –ø—Ä–∏–±—ã–ª—å ${benefit} ‚Ç∏. –ù–∞—á–∞—Ç—å.`
                ],
                '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏': [
                    `${name}, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ —Å –Ω–∏–∑–∫–∏–º –ø–æ—Ä–æ–≥–æ–º –≤—Ö–æ–¥–∞ –∏ –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–π –Ω–∞ —Å—Ç–∞—Ä—Ç. –û—Ç–∫—Ä—ã—Ç—å —Å—á—ë—Ç.`,
                    `${name}, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –æ—Ç 6 ‚Ç∏. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–æ—Ö–æ–¥–∞ ${benefit} ‚Ç∏ –≤ –∫–≤–∞—Ä—Ç–∞–ª. –ù–∞—á–∞—Ç—å.`
                ],
                '–û–±–º–µ–Ω –≤–∞–ª—é—Ç': [
                    `${name}, —ç–∫–æ–Ω–æ–º—å—Ç–µ –Ω–∞ –æ–±–º–µ–Ω–µ –≤–∞–ª—é—Ç. –í—ã–≥–æ–¥–Ω—ã–π –∫—É—Ä—Å 24/7, —ç–∫–æ–Ω–æ–º–∏—è –¥–æ ${benefit} ‚Ç∏. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å.`,
                    `${name}, –º–µ–Ω—è–µ—Ç–µ –≤–∞–ª—é—Ç—É? –ö—É—Ä—Å –ª—É—á—à–µ –Ω–∞ 1-2% –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±–º–µ–Ω.`
                ]
            };
            
            const productTemplates = templates[product.name] || [
                `${name}, –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏. –í—ã–≥–æ–¥–∞ ${benefit} ‚Ç∏. –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ.`
            ];
            
            let notification = isYoung ? productTemplates[1] || productTemplates[0] : productTemplates[0];
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã
            if (notification.length > 220) {
                notification = notification.substring(0, 217) + '...';
            } else if (notification.length < 180) {
                notification += ' –ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.';
            }
            
            return notification;
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function displayResults() {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '';
            
            results.slice(0, 10).forEach(result => {
                container.innerHTML += `
                    <div class="client-card">
                        <div class="client-header">
                            <strong>–ö–ª–∏–µ–Ω—Ç #${result.client_code}</strong>
                        </div>
                        <div class="product-badge">${result.product}</div>
                        <div class="notification-box">
                            ${result.push_notification}
                        </div>
                    </div>
                `;
            });
            
            if (results.length > 10) {
                container.innerHTML += `
                    <p style="text-align: center; color: #6b7280; margin: 20px;">
                        –ü–æ–∫–∞–∑–∞–Ω–æ 10 –∏–∑ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    </p>
                `;
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        function displayAnalytics() {
            const productCounts = {};
            results.forEach(r => {
                productCounts[r.product] = (productCounts[r.product] || 0) + 1;
            });
            
            const data = [{
                labels: Object.keys(productCounts),
                values: Object.values(productCounts),
                type: 'pie',
                hole: 0.3,
                marker: {
                    colors: ['#667eea', '#764ba2', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4', '#ec4899']
                }
            }];
            
            const layout = {
                title: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤',
                height: 400
            };
            
            Plotly.newPlot('chartContainer', data, layout);
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤
        function displayExamples() {
            const container = document.getElementById('examplesContainer');
            
            const examples = results.slice(0, 3);
            examples.forEach(example => {
                const client = clientsData.find(c => c.client_code === example.client_code);
                
                container.innerHTML += `
                    <div class="phone-mockup">
                        <div class="phone-screen">
                            <div class="notification-preview">
                                <div class="app-icon">üè¶</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; font-size: 14px;">GoKens Bank</div>
                                    <div style="font-size: 13px; color: #4b5563; margin-top: 5px;">
                                        ${example.push_notification}
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; padding: 10px;">
                                <button style="flex: 1; background: #f3f4f6; border: none; padding: 8px; border-radius: 8px;">
                                    –ü–æ–∑–∂–µ
                                </button>
                                <button style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px; border-radius: 8px;">
                                    –û—Ç–∫—Ä—ã—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
        function switchTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Ç–∞–±—ã
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }
        
        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ CSV
        function downloadCSV() {
            let csv = 'client_code,product,push_notification\n';
            results.forEach(r => {
                csv += `${r.client_code},"${r.product}","${r.push_notification}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'recommendations.csv';
            link.click();
        }
    </script>
</body>
</html>